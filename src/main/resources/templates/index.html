<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head th:replace="common/header :: common-header"></head>
<body>
<nav th:replace="common/navbar :: common-navbar"></nav>
<div class="d-flex">
    <div class="w-25 p-2 pl-3">
        <div id="userInfo" class="mb-3" style="height: 108px">
            <span th:if="${loggedUser == null}">No logged user, please select one from the list below</span>
            <fieldset th:if="${loggedUser != null}" class="border">
                <legend class="ml-3 w-auto" th:text="'Logged as ' + ${loggedUser.login}"></legend>
                <ul>
                    <li th:text="'First name: ' + ${loggedUser.firstName}"></li>
                    <li th:text="'Last name: ' + ${loggedUser.lastName}"></li>
                </ul>
            </fieldset>
        </div>
        <div id="userList">
            <h4>Login as:</h4>
            <table class="table table-hover table-bordered">
                <tbody>
                <tr th:each="user : ${userList}" th:data="${user.login}" class="clickable-row"
                    th:onclick="javascript:rowClicked(this.getAttribute('data'));">
                    <td>
                        <span th:text="${user.login}"></span>
                        <i th:if="${loggedUser != null && loggedUser.login == user.login}" style="color: #563d7c"
                           class="fas fa-eye float-right" data-fa-transform="down-5"></i>
                    </td>
                </tr>
                </tbody>
            </table>
            <script>
                function rowClicked(value) {
                    location.href = "/logged/" + value;
                }
            </script>
        </div>
    </div>

    <div class="w-50 p-2">
        <div id="newPost" class="mt-2" style="height: 180px">
            <span th:if="${loggedUser == null}">Log in to post your thoughts</span>
            <div th:if="${loggedUser != null}">
                <form th:action="@{/add-post}" th:object="${newPost}" method="post">
                    <div class="form-group">
                        <label for="post">Add post</label>
                        <textarea class="form-control" id="post" rows="3" placeholder="Write what you think..."
                                  th:field="${newPost.content}" style="resize: none" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-secondary">Post!</button>
                </form>
            </div>
        </div>

        <div id="postList" class="mt-2 w-100">
            <table class="w-100">
                <tbody>
                <tr th:each="post : ${postList}">
                    <td>
                        <div class="shadow-sm p-3 mb-5 post rounded w-100">
                            <strong th:text="${post.author.login}"></strong>
                            <p class="date" th:text="${post.postedAt}"></p>
                            <p th:text="${post.content}"></p>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="w-25 p-2">
        <fieldset id="recommended" class="border p-2 pl-3">
            <legend class="w-auto">Recommended to follow</legend>
            <span th:if="${loggedUser == null}">Log in to see your recommendations</span>
            <table class="w-100" th:if="${loggedUser != null}">
                <tbody>
                <tr th:each="user: ${recommendedUsers}">
                    <td>
                        <form th:action="@{/follow}" th:object="${newFollowing}" method="post">
                            <span th:text="${user.login}"></span>
                            <input type="hidden" th:value="${user.login}" name="login"/>
                            <button type="submit" class="btn btn-light btn-sm float-right mr-5">‚ù§</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset id="following" class="border p-2 pl-3">
            <legend class="w-auto">Following</legend>
            <span th:if="${loggedUser == null}">Log in to see your followers</span>
            <table class="w-100" th:if="${loggedUser != null}">
                <tbody>
                <tr th:each="user: ${followedUsers}">
                    <td>
                        <form th:action="@{/unfollow}" th:object="${unfollow}" method="post">
                            <span th:text="${user.login}"></span>
                            <input type="hidden" th:value="${user.login}" name="login"/>
                            <button type="submit" class="btn btn-light btn-sm float-right mr-5">üíî</button>
                        </form>
                    </td>
                </tr>
                </tbody>
            </table>
        </fieldset>
    </div>
</div>
</body>
</html>
